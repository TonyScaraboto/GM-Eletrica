---
import "../styles/global.css";

const {
  title = "GM Eletricista - Serviços Elétricos em Peruíbe",
  description = "Instalações, manutenções e projetos elétricos residenciais, comerciais e industriais em Peruíbe e região. Segurança, design e atendimento profissional.",
  navItems = [
    { label: "Início", href: "/" },
    { label: "Diferenciais", href: "/diferenciais" },
    { label: "Serviços", href: "/servicos" },
    { label: "Processo", href: "/processo" },
    { label: "Contato", href: "/contato" },
  ],
  currentPath = "/",
  ano = new Date().getFullYear(),
}: {
  title?: string;
  description?: string;
  navItems?: { label: string; href: string }[];
  currentPath?: string;
  ano?: number;
} = Astro.props;
---

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const contactFab = document.getElementById("contactFab");
    const contactBalloons = document.getElementById("contactBalloons");
    let balloonsVisible = false;
    if (contactFab && contactBalloons) {
      contactFab.addEventListener("click", (e) => {
        e.stopPropagation();
        balloonsVisible = !balloonsVisible;
        if (balloonsVisible) {
          contactBalloons.classList.add("active");
          setTimeout(() => {
            document.addEventListener("click", hideBalloons, { once: true });
          }, 10);
        } else {
          contactBalloons.classList.remove("active");
        }
      });
      function hideBalloons(event) {
        if (
          !contactBalloons.contains(event.target) &&
          event.target !== contactFab
        ) {
          contactBalloons.classList.remove("active");
          balloonsVisible = false;
        }
      }
      contactBalloons.querySelectorAll("a").forEach((btn) => {
        btn.addEventListener("click", () => {
          contactBalloons.classList.remove("active");
          balloonsVisible = false;
        });
      });
    }
  });
</script>

<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#060607" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <slot name="head" />
  </head>
  <body>
    <header class="top-bar" id="topo">
      <div class="container">
        <nav class="nav">
          <a class="brand" href="/" aria-label="GM Eletricista - início">
            <img
              class="brand__logo"
              src="/images/logo-gm.png"
              alt="Logotipo GM Eletricista"
              loading="lazy"
            />
            <span class="brand__name">GM Eletricista</span>
          </a>
          <button class="nav-toggle" aria-expanded="false" aria-controls="menu">
            <span class="sr-only">Abrir menu lateral</span>
            <span></span>
            <span></span>
            <span></span>
          </button>
          <ul class="menu" id="menu" aria-expanded="false">
            <li class="menu__header">
              <span>Navegação</span>
              <button
                class="menu__close"
                type="button"
                aria-label="Fechar menu"
              >
                <span aria-hidden="true">←</span>
              </button>
            </li>
            {
              navItems.map(({ label, href }) => {

                // Corrige comparação para garantir que só a página correta fique ativa
                const normalize = (url) => url.replace(/\/$/, "");
                let isCurrent = false;
                if (href === "/") {
                  isCurrent = currentPath === "/";
                } else {
                  isCurrent = normalize(currentPath) === normalize(href);
                }

                return (
                  <li>
                    <a
                      href={href}
                      aria-current={isCurrent ? "page" : undefined}
                    >
                      {label}
                    </a>
                  </li>
                );
              })
            }
            <li class="menu__cta">
              <a class="nav-cta" href="/contato">Contato rápido</a>
            </li>
          </ul>
          <a class="nav-cta" href="/contato">Contato rápido</a>
        </nav>
        <div class="menu-backdrop" aria-hidden="true"></div>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <div class="container footer__grid">
        <div>
          <strong>GM Eletricista</strong>
          <p>
            Instalações e manutenções elétricas para portões automáticos,
            ventiladores e projetos completos com foco em segurança e design.
          </p>
        </div>
        <div>
          <p>&copy; {ano} GM Eletricista. Todos os direitos reservados.</p>
          <a class="footer__link" href="#topo" id="backToTop">Voltar ao topo</a>
        </div>
      </div>
    </footer>


    <div class="social-fab-group" aria-hidden="false">
      <a
        class="social-fab whatsapp-fab"
        href="https://wa.me/5513996999930?text=Oi!%20vi%20seu%20site%20de%20servi%C3%A7os%20eletricos%20e%20preciso%20de%20um%20atendimento!"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Conversar no WhatsApp com a GM Eletricista"
        id="whatsappFab"
      >
        <svg
          class="whatsapp-fab__icon"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 32 32"
          role="img"
          aria-hidden="true"
        >
          <path
            d="M16 3A12.94 12.94 0 0 0 3 16a12.77 12.77 0 0 0 1.83 6.63L3 29l6.56-1.77A13 13 0 1 0 16 3Zm0 2.06a10.94 10.94 0 0 1 8.81 17.57l-.38.47.81 3.06-3.13-.82-.45.27A10.94 10.94 0 0 1 5.07 16 10.93 10.93 0 0 1 16 5.06Zm-5.67 4.36h-.43a.9.9 0 0 0-.64.31 4.91 4.91 0 0 0-1.57 3.64 8.52 8.52 0 0 0 2.68 4.67 12.73 12.73 0 0 0 5.46 3 5.39 5.39 0 0 0 2 .36 4.61 4.61 0 0 0 2.18-.61 2 2 0 0 0 1-1.61 1.73 1.73 0 0 0-.2-.93 7.78 7.78 0 0 0-.78-1.21 1.72 1.72 0 0 0-2.33-.38l-.83.53a.62.62 0 0 1-.72 0 10.63 10.63 0 0 1-1.81-1.12 7.69 7.69 0 0 1-1.88-2.28.55.55 0 0 1 .09-.67c.18-.21.38-.42.57-.62.19-.2.3-.45.45-.67a1.36 1.36 0 0 0 0-1.45c-.24-.45-.5-.9-.78-1.34a1.8 1.8 0 0 0-1.38-1Z"
          ></path>
        </svg>
      </a>

      <a
        class="social-fab instagram"
        href="https://www.instagram.com/gmeletricistaperuibe/"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Visitar Instagram da GM Eletricista"
        data-tooltip="Instagram"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="20"
          height="20"
          role="img"
          aria-hidden="true"
        >
          <path
            d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.337 3.608 1.312.975.975 1.25 2.242 1.312 3.608.058 1.266.069 1.646.069 4.85s-.012 3.584-.07 4.85c-.062 1.366-.337 2.633-1.312 3.608-.975.975-2.242 1.25-3.608 1.312-1.266.058-1.646.069-4.85.069s-3.584-.012-4.85-.07c-1.366-.062-2.633-.337-3.608-1.312-.975-.975-1.25-2.242-1.312-3.608C2.175 15.647 2.163 15.267 2.163 12s.012-3.584.07-4.85c.062-1.366.337-2.633 1.312-3.608.975-.975 2.242-1.25 3.608-1.312C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.014 7.052.072 5.77.13 4.663.347 3.68 1.33 2.697 2.313 2.48 3.42 2.422 4.702 2.364 5.982 2.35 6.392 2.35 12s.014 6.018.072 7.298c.058 1.282.275 2.389 1.258 3.372.983.983 2.09 1.2 3.372 1.258C8.332 23.986 8.741 24 12 24s3.668-.014 4.948-.072c1.282-.058 2.389-.275 3.372-1.258.983-.983 1.2-2.09 1.258-3.372.058-1.28.072-1.689.072-4.948s-.014-3.668-.072-4.948c-.058-1.282-.275-2.389-1.258-3.372C19.337.347 18.23.13 16.948.072 15.668.014 15.259 0 12 0z"
          ></path>
          <path
            d="M12 5.838A6.162 6.162 0 1 0 12 18.162 6.162 6.162 0 1 0 12 5.838zm0 10.162A4 4 0 1 1 12 6a4 4 0 0 1 0 8z"
          ></path>
          <circle cx="18.406" cy="5.594" r="1.44"></circle>
        </svg>
      </a>

      <a
        class="social-fab facebook"
        href="https://www.facebook.com/profile.php?id=61587410630933"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Visitar Facebook da GM Eletricista"
        data-tooltip="Facebook"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="20"
          height="20"
          role="img"
          aria-hidden="true"
        >
          <path
            d="M22 12.07C22 6.51 17.52 2 12 2S2 6.51 2 12.07C2 17.08 5.66 21.37 10.44 22v-7.07H7.9v-2.9h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.23.2 2.23.2v2.45h-1.25c-1.23 0-1.61.76-1.61 1.55v1.84h2.74l-.44 2.9h-2.3V22C18.34 21.37 22 17.08 22 12.07z"
          ></path>
        </svg>
      </a>
    </div>

    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const navToggle = document.querySelector(".nav-toggle");
        const menu = document.getElementById("menu");
        const backdrop = document.querySelector(".menu-backdrop");
        const closeButton = document.querySelector(".menu__close");

        if (!navToggle || !menu) {
          return;
        }

        const setMenuState = (isOpen) => {
          navToggle.setAttribute("aria-expanded", String(isOpen));
          menu.setAttribute("aria-expanded", String(isOpen));
          document.body.classList.toggle("is-menu-open", isOpen);
          if (backdrop) {
            backdrop.classList.toggle("is-active", isOpen);
          }
        };

        navToggle.addEventListener("click", () => {
          const isExpanded = navToggle.getAttribute("aria-expanded") === "true";
          setMenuState(!isExpanded);
        });

        menu.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", () => setMenuState(false));
        });

        if (backdrop) {
          backdrop.addEventListener("click", () => setMenuState(false));
        }

        if (closeButton) {
          closeButton.addEventListener("click", () => setMenuState(false));
        }

        // Back to top functionality
        const backToTopLink = document.getElementById("backToTop");
        if (backToTopLink) {
          backToTopLink.addEventListener("click", (e) => {
            e.preventDefault();
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          });
        }

        document.addEventListener("keydown", (event) => {
          if (
            event.key === "Escape" &&
            navToggle.getAttribute("aria-expanded") === "true"
          ) {
            setMenuState(false);
          }
        });

        window.addEventListener("resize", () => {
          if (window.innerWidth > 960) {
            setMenuState(false);
          }
        });

        const prefersReducedMotion = window.matchMedia(
          "(prefers-reduced-motion: reduce)",
        ).matches;
        if (!prefersReducedMotion) {
          const overlay = document.createElement("div");
          overlay.className = "page-transition";
          document.body.appendChild(overlay);

          requestAnimationFrame(() => {
            overlay.classList.add("is-idle");
          });

          const handleInternalNavigation = (event) => {
            const anchor = event.currentTarget;

            if (
              (anchor.target && anchor.target !== "_self") ||
              anchor.hasAttribute("download") ||
              event.metaKey ||
              event.ctrlKey ||
              event.shiftKey ||
              event.altKey
            ) {
              return;
            }

            const url = new URL(anchor.href, window.location.href);
            if (url.pathname === window.location.pathname && url.hash) {
              return;
            }

            event.preventDefault();
            overlay.classList.remove("is-idle");

            window.setTimeout(() => {
              window.location.href = anchor.href;
            }, 280);
          };

          document.querySelectorAll('a[href^="/"]').forEach((anchor) => {
            anchor.addEventListener("click", handleInternalNavigation);
          });

          window.addEventListener("pageshow", () => {
            overlay.classList.add("is-idle");
          });
        }
      });
    </script>
  </body>
</html>
