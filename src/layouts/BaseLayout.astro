---
import "../styles/global.css";

interface NavItem {
  label: string;
  href: string;
}

interface Props {
  title?: string;
  description?: string;
}

const { title = "GM Eletricista", description = "Instalação e manutenção elétrica executadas com segurança e conformidade técnica." } = Astro.props as Props;

const navItems: NavItem[] = [
  { label: "Início", href: "/" },
  { label: "Serviços", href: "/servicos" },
  { label: "Processo", href: "/processo" },
  { label: "Segmentos", href: "/diferenciais" }
];

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
const ano = new Date().getFullYear();
---

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const whatsappFab = document.getElementById('whatsappFab');
    const socialFabGroup = document.getElementById('socialFabGroup');
    let socialVisible = false;
    if (whatsappFab && socialFabGroup) {
      whatsappFab.addEventListener('click', (e) => {
        if (!socialVisible) {
          e.preventDefault();
          socialFabGroup.classList.add('active');
          socialVisible = true;
          setTimeout(() => {
            document.addEventListener('click', hideSocial, { once: true });
          }, 10);
        }
      });
      function hideSocial(event) {
        if (
          !socialFabGroup.contains(event.target) &&
          event.target !== whatsappFab
        ) {
          socialFabGroup.classList.remove('active');
          socialVisible = false;
        }
      }
      socialFabGroup.querySelectorAll('a').forEach(btn => {
        btn.addEventListener('click', () => {
          socialFabGroup.classList.remove('active');
          socialVisible = false;
        });
      });
    }
  });
</script>
    <div class="social-fab-group" id="socialFabGroup">
      <a
        class="social-fab instagram"
        href="https://www.instagram.com/gmeletricistaperuibe/" target="_blank" rel="noopener noreferrer"
        aria-label="Instagram da GM Eletricista"
      >
        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <circle cx="12" cy="12" r="10" stroke="#e1306c" stroke-width="2" fill="none"/>
          <circle cx="12" cy="12" r="5" fill="#e1306c"/>
        </svg>
      </a>
      <a
        class="social-fab facebook"
        href="https://www.facebook.com/profile.php?id=61587410630933" target="_blank" rel="noopener noreferrer"
        aria-label="Facebook da GM Eletricista"
      >
        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <rect x="4" y="4" width="16" height="16" rx="4" fill="#1877f3"/>
          <text x="12" y="17" text-anchor="middle" font-size="12" fill="#fff" font-family="Arial, sans-serif">f</text>
        </svg>
      </a>
    </div>
---

<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#060607" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <slot name="head" />
  </head>
  <body>
    <header class="top-bar" id="topo">
      <div class="container">
        <nav class="nav">
          <a class="brand" href="/" aria-label="GM Eletricista - início">
            <img class="brand__logo" src="/images/logo-gm.png" alt="Logotipo GM Eletricista" loading="lazy" />
            <span class="brand__name">GM Eletricista</span>
          </a>
          <button class="nav-toggle" aria-expanded="false" aria-controls="menu">
            <span class="sr-only">Abrir menu lateral</span>
            <span></span>
            <span></span>
            <span></span>
          </button>
          <ul class="menu" id="menu" aria-expanded="false">
            <li class="menu__header">
              <span>Navegação</span>
              <button class="menu__close" type="button" aria-label="Fechar menu">
                <span aria-hidden="true">←</span>
              </button>
            </li>
            {navItems.map(({ label, href }) => {
              const normalizedHref = href === "/" ? "/" : href.replace(/\/$/, "");
              const isCurrent = currentPath === normalizedHref;

              return (
                <li>
                  <a href={href} aria-current={isCurrent ? "page" : undefined}>{label}</a>
                </li>
              );
            })}
            <li class="menu__cta">
              <a class="nav-cta" href="/contato">Contato rápido</a>
            </li>
          </ul>
          <a class="nav-cta" href="/contato">Contato rápido</a>
        </nav>
        <div class="menu-backdrop" aria-hidden="true"></div>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <div class="container footer__grid">
        <div>
          <strong>GM Eletricista</strong>
          <p>Instalações e manutenções elétricas para portões automáticos, ventiladores e projetos completos com foco em segurança e design.</p>
        </div>
        <div>
          <p>&copy; {ano} GM Eletricista. Todos os direitos reservados.</p>
          <a class="footer__link" href="#topo" id="backToTop">Voltar ao topo</a>
        </div>
      </div>
    </footer>




    <a
      class="whatsapp-fab"
      href="https://wa.me/5513996999930?text=Oi!%20vi%20seu%20site%20de%20servi%C3%A7os%20eletricos%20e%20preciso%20de%20um%20atendimento!"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Conversar no WhatsApp com a GM Eletricista"
      id="whatsappFab"
    >
      <svg
        class="whatsapp-fab__icon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 32 32"
        role="img"
        aria-hidden="true"
      >
        <path
          d="M16 3A12.94 12.94 0 0 0 3 16a12.77 12.77 0 0 0 1.83 6.63L3 29l6.56-1.77A13 13 0 1 0 16 3Zm0 2.06a10.94 10.94 0 0 1 8.81 17.57l-.38.47.81 3.06-3.13-.82-.45.27A10.94 10.94 0 0 1 5.07 16 10.93 10.93 0 0 1 16 5.06Zm-5.67 4.36h-.43a.9.9 0 0 0-.64.31 4.91 4.91 0 0 0-1.57 3.64 8.52 8.52 0 0 0 2.68 4.67 12.73 12.73 0 0 0 5.46 3 5.39 5.39 0 0 0 2 .36 4.61 4.61 0 0 0 2.18-.61 2 2 0 0 0 1-1.61 1.73 1.73 0 0 0-.2-.93 7.78 7.78 0 0 0-.78-1.21 1.72 1.72 0 0 0-2.33-.38l-.83.53a.62.62 0 0 1-.72 0 10.63 10.63 0 0 1-1.81-1.12 7.69 7.69 0 0 1-1.88-2.28.55.55 0 0 1 .09-.67c.18-.21.38-.42.57-.62.19-.2.3-.45.45-.67a1.36 1.36 0 0 0 0-1.45c-.24-.45-.5-.9-.78-1.34a1.8 1.8 0 0 0-1.38-1Z"
        />
      </svg>
    </a>

    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        const navToggle = document.querySelector('.nav-toggle');
        const menu = document.getElementById('menu');
        const backdrop = document.querySelector('.menu-backdrop');
        const closeButton = document.querySelector('.menu__close');

        if (!navToggle || !menu) {
          return;
        }

        const setMenuState = (isOpen) => {
          navToggle.setAttribute('aria-expanded', String(isOpen));
          menu.setAttribute('aria-expanded', String(isOpen));
          document.body.classList.toggle('is-menu-open', isOpen);
          if (backdrop) {
            backdrop.classList.toggle('is-active', isOpen);
          }
        };

        navToggle.addEventListener('click', () => {
          const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
          setMenuState(!isExpanded);
        });

        menu.querySelectorAll('a').forEach((link) => {
          link.addEventListener('click', () => setMenuState(false));
        });

        if (backdrop) {
          backdrop.addEventListener('click', () => setMenuState(false));
        }

        if (closeButton) {
          closeButton.addEventListener('click', () => setMenuState(false));
        }

        // Back to top functionality
        const backToTopLink = document.getElementById('backToTop');
        if (backToTopLink) {
          backToTopLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        }

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && navToggle.getAttribute('aria-expanded') === 'true') {
            setMenuState(false);
          }
        });

        window.addEventListener('resize', () => {
          if (window.innerWidth > 960) {
            setMenuState(false);
          }
        });

        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (!prefersReducedMotion) {
          const overlay = document.createElement('div');
          overlay.className = 'page-transition';
          document.body.appendChild(overlay);

          requestAnimationFrame(() => {
            overlay.classList.add('is-idle');
          });

          const handleInternalNavigation = (event) => {
            const anchor = event.currentTarget;

            if (
              anchor.target && anchor.target !== '_self' ||
              anchor.hasAttribute('download') ||
              event.metaKey ||
              event.ctrlKey ||
              event.shiftKey ||
              event.altKey
            ) {
              return;
            }

            const url = new URL(anchor.href, window.location.href);
            if (url.pathname === window.location.pathname && url.hash) {
              return;
            }

            event.preventDefault();
            overlay.classList.remove('is-idle');

            window.setTimeout(() => {
              window.location.href = anchor.href;
            }, 280);
          };

          document.querySelectorAll('a[href^="/"]').forEach((anchor) => {
            anchor.addEventListener('click', handleInternalNavigation);
          });

          window.addEventListener('pageshow', () => {
            overlay.classList.add('is-idle');
          });
        }
      });
    </script>
  </body>
</html>
